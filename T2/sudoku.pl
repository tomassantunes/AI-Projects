tamanho(9).

estado_inicial(e([var((1, 1), [1,2,3,4,5,6,7,8,9], _), var((1, 3), [1,2,3,4,5,6,7,8,9], _), var((1, 4), [1,2,3,4,5,6,7,8,9], _), var((1, 5), [1,2,3,4,5,6,7,8,9], _), 
                var((1, 7), [1,2,3,4,5,6,7,8,9], _), var((2, 1), [1,2,3,4,5,6,7,8,9], _), var((2, 2), [1,2,3,4,5,6,7,8,9], _), var((2, 3), [1,2,3,4,5,6,7,8,9], _), 
                var((2, 5), [1,2,3,4,5,6,7,8,9], _), var((2, 7), [1,2,3,4,5,6,7,8,9], _), var((2, 8), [1,2,3,4,5,6,7,8,9], _), var((2, 9), [1,2,3,4,5,6,7,8,9], _),
                var((3, 2), [1,2,3,4,5,6,7,8,9], _), var((3, 3), [1,2,3,4,5,6,7,8,9], _), var((3, 4), [1,2,3,4,5,6,7,8,9], _), var((3, 5), [1,2,3,4,5,6,7,8,9], _), 
                var((3, 6), [1,2,3,4,5,6,7,8,9], _), var((3, 8), [1,2,3,4,5,6,7,8,9], _), var((4, 1), [1,2,3,4,5,6,7,8,9], _), var((4, 2), [1,2,3,4,5,6,7,8,9], _), 
                var((4, 3), [1,2,3,4,5,6,7,8,9], _), var((4, 4), [1,2,3,4,5,6,7,8,9], _), var((4, 5), [1,2,3,4,5,6,7,8,9], _), var((4, 7), [1,2,3,4,5,6,7,8,9], _),
                var((4, 8), [1,2,3,4,5,6,7,8,9], _), var((4, 9), [1,2,3,4,5,6,7,8,9], _), var((5, 1), [1,2,3,4,5,6,7,8,9], _), var((5, 2), [1,2,3,4,5,6,7,8,9], _), 
                var((5, 3), [1,2,3,4,5,6,7,8,9], _), var((5, 4), [1,2,3,4,5,6,7,8,9], _), var((5, 7), [1,2,3,4,5,6,7,8,9], _), var((6, 2), [1,2,3,4,5,6,7,8,9], _), 
                var((6, 3), [1,2,3,4,5,6,7,8,9], _), var((6, 5), [1,2,3,4,5,6,7,8,9], _), var((6, 6), [1,2,3,4,5,6,7,8,9], _), var((6, 7), [1,2,3,4,5,6,7,8,9], _), 
                var((6, 8), [1,2,3,4,5,6,7,8,9], _), var((6, 9), [1,2,3,4,5,6,7,8,9], _), var((7, 1), [1,2,3,4,5,6,7,8,9], _), var((7, 2), [1,2,3,4,5,6,7,8,9], _), 
                var((7, 3), [1,2,3,4,5,6,7,8,9], _), var((7, 5), [1,2,3,4,5,6,7,8,9], _), var((7, 6), [1,2,3,4,5,6,7,8,9], _), var((7, 7), [1,2,3,4,5,6,7,8,9], _), 
                var((7, 8), [1,2,3,4,5,6,7,8,9], _), var((7, 9), [1,2,3,4,5,6,7,8,9], _), var((8, 3), [1,2,3,4,5,6,7,8,9], _), var((8, 4), [1,2,3,4,5,6,7,8,9], _), 
                var((8, 6), [1,2,3,4,5,6,7,8,9], _), var((8, 7), [1,2,3,4,5,6,7,8,9], _), var((8, 9), [1,2,3,4,5,6,7,8,9], _), var((9, 1), [1,2,3,4,5,6,7,8,9], _), 
                var((9, 2), [1,2,3,4,5,6,7,8,9], _), var((9, 4), [1,2,3,4,5,6,7,8,9], _), var((9, 5), [1,2,3,4,5,6,7,8,9], _), var((9, 7), [1,2,3,4,5,6,7,8,9], _), 
                var((9, 8), [1,2,3,4,5,6,7,8,9], _), var((9, 9), [1,2,3,4,5,6,7,8,9], _)],
               [var((1, 2), [1,2,3,4,5,6,7,8,9], 1), var((1, 6), [1,2,3,4,5,6,7,8,9], 8), var((1, 8), [1,2,3,4,5,6,7,8,9], 7), var((1, 9), [1,2,3,4,5,6,7,8,9], 3),
                var((2, 4), [1,2,3,4,5,6,7,8,9], 6), var((2, 6), [1,2,3,4,5,6,7,8,9], 9), var((3, 1), [1,2,3,4,5,6,7,8,9], 7), var((3, 7), [1,2,3,4,5,6,7,8,9], 9), 
                var((3, 9), [1,2,3,4,5,6,7,8,9], 4), var((4, 6), [1,2,3,4,5,6,7,8,9], 4), var((5, 5), [1,2,3,4,5,6,7,8,9], 3), var((5, 6), [1,2,3,4,5,6,7,8,9], 6),
                var((5, 8), [1,2,3,4,5,6,7,8,9], 1), var((5, 9), [1,2,3,4,5,6,7,8,9], 8), var((6, 1), [1,2,3,4,5,6,7,8,9], 8), var((6, 4), [1,2,3,4,5,6,7,8,9], 9),
                var((7, 4), [1,2,3,4,5,6,7,8,9], 7), var((8, 1), [1,2,3,4,5,6,7,8,9], 2), var((8, 2), [1,2,3,4,5,6,7,8,9], 5), var((8, 5), [1,2,3,4,5,6,7,8,9], 4), 
                var((8, 8), [1,2,3,4,5,6,7,8,9], 3), var((9, 3), [1,2,3,4,5,6,7,8,9], 6), var((9, 6), [1,2,3,4,5,6,7,8,9], 3)])).

ve_restricoes(E):-
    ver_linhas(E),
    ver_colunas(E),
    ver_quadrantes(E).

ver_linhas(e(_,[var((X,_Y), _D, V)|R])):-
    findall(V1,member(var((X,_),_,V1),R),L),
    todos_diff([V|L]).
  
ver_colunas(e(_,[var((_X,Y), _D, V)|R])):-
    findall(V1,member(var((_,Y),_,V1),R),L),
    todos_diff([V|L]).

ver_quadrantes(e(_,A)) :-
    ver_quad(A, 1, 1, 3, Q1),
    todos_diff(Q1),
    ver_quad(A, 1, 4, 6, Q2),
    todos_diff(Q2),
    ver_quad(A, 1, 7, 9, Q3),
    todos_diff(Q3),
    ver_quad(A, 4, 1, 3, Q4),
    todos_diff(Q4),
    ver_quad(A, 4, 4, 6, Q5),
    todos_diff(Q5),
    ver_quad(A, 4, 7, 9, Q6),
    todos_diff(Q6),
    ver_quad(A, 7, 1, 3, Q7),
    todos_diff(Q7),
    ver_quad(A, 7, 4, 6, Q8),
    todos_diff(Q8),
    ver_quad(A, 7, 7, 9, Q9),
    todos_diff(Q9).

ver_quad(L, X, Y, Y2, Q) :-
    Y = Y2, X1 is X+2,
    add_quad(L, X, Y, X1, Q).

ver_quad(L, X, Y, Y2, Q) :-
    Y < Y2, Y1 is Y+1,
    X1 is X+2,
    add_quad(L, X, Y, X1, L1),
    append(L1, L2, Q),
    ver_quad(L, X, Y1, Y2, L2).

add_quad(L, X, Y, X2, []) :-
    X = X2,
    \+member(var((X, Y), _, _), L).

add_quad(L, X, Y, X2, [V]) :-
    X = X2,
    member(var((X, Y), _, V), L).

add_quad(L, X, Y, X2, T) :-
    X < X2, X1 is X+1,
    \+member(var((X, Y), _, _), L),
    add_quad(L, X1, Y, X2, T).

add_quad(L, X, Y, X2, [V|T]) :-
    X < X2,
    member(var((X, Y), _, V), L),
    X1 is X+1,
    add_quad(L, X1, Y, X2, T).

todos_diff([]).
todos_diff([X|R]):-
    \+ member(X,R), todos_diff(R).

sucessor(e([var(N,D,_)|R],E),e(R,[var(N,D,V)|E])):- 
    member(V,D).

back(e([],A),A).
back(E,Sol):- 
    sucessor(E,E1), 
    ve_restricoes(E1),
    back(E1,Sol).

forward(e([],A),A).
forward(E,Sol):- 
    sucessor(E,E1),
    ve_restricoes(E1), 
    forCheck(E1, E2),
    forward(E2, Sol).

forCheck(e(Lni,[var(N,D,V)|Li]), e(Lnii, [var(N,D,V)|Li])) :- corta(V,Lni,Lnii).

corta(_,[],[]).
corta(V,[var(N,_D,_)|NA],[var(N,_DS,_)|NAS]):-  
    corta(V, NA, NAS).

sudoku_back:- 
    estado_inicial(E0), 
    back(E0,A), 
    esc(A).

sudoku_forward:-
    estado_inicial(E0),
    forward(E0,A), 
    esc(A).

esc(L) :- sort(L, L1), esc_a(L1),nl.
esc_a(L) :- tamanho(S), esc_l(L, 1, S).

esc_l([H], S, S):-
    H = var(_,_,X), write(X),nl.

esc_l([H|T], S, S):-
    H = var(_,_,X), write(X), nl,
    esc_l(T, 1, S).

esc_l([H|T], I, S):- 
    I<S, I2 is I+1,
    H = var(_,_,X), write(X),write(' . '),
    esc_l(T, I2, S).
